<div class="room-selection-wrapper">
  <h2 class="section-title">Wybierz salę do gry</h2>

  <div class="room-buttons">
    @for (room of rooms(); track room) {
    <button
      class="btn btn-outline-light"
      [class.active]="store.selectedRoom() === room"
      (click)="selectRoom(room)"
    >
      {{ room }}
    </button>
    }
  </div>

  @if (isGoldenBlocked()) {
  <div class="alert alert-warning">
    Masz już aktywną rezerwację. Nie możesz dokonać kolejnej.
  </div>
  } @if (isMemberClubBlocked && !store.isReceptionMode()) {
  <div class="alert alert-warning">
    W tym tygodniu masz już rezerwację w jednej z sal klubowych (Asgard lub
    Alfheim). Możesz zarezerwować inną salę.
  </div>
  } @else if (isMemberClubBlocked && store.isReceptionMode()){
  <div class="alert alert-warning">
    W tym tygodniu drużyna {{ getSelectedPartyName() }} ma już rezwację w jednej
    z sal klubowych (Asgard lub Alfheim). Możesz zarezerwować inną salę.
  </div>
  }

  <div ngbDropdown class="category-dropdown">
    <button
      type="button"
      class="btn btn-outline"
      id="dropdownParties"
      ngbDropdownToggle
    >
      {{ getSelectedPartyName() || "Wybierz drużynę" }}
    </button>

    <div ngbDropdownMenu aria-labelledby="dropdownParties">
      @if (partiesJoin().length) {
      <h6 class="dropdown-header">Dołącz do Drużyny</h6>
      @for (party of partiesJoin(); track party.id) {
      <button ngbDropdownItem (click)="selectParty(party.id)">
        {{ party.name }}
      </button>
      } @if (partiesGm().length || partiesMine().length) {
      <div class="dropdown-divider"></div>
      } } @if (partiesGm().length) {
      <h6 class="dropdown-header">Mistrz Gry</h6>
      @for (party of partiesGm(); track party.id) {
      <button ngbDropdownItem (click)="selectParty(party.id)">
        {{ party.name }}
      </button>
      } @if (partiesMine().length) {
      <div class="dropdown-divider"></div>
      } } @if (partiesMine().length) {
      <h6 class="dropdown-header">
        {{ store.isReceptionMode() ? "Pozostałe drużyny" : "Moje drużyny" }}
      </h6>
      @for (party of partiesMine(); track party.id) {
      <button ngbDropdownItem (click)="selectParty(party.id)">
        {{ party.name }}
      </button>
      } } @if (!partiesJoin().length && !partiesGm().length &&
      !partiesMine().length) {
      <span class="dropdown-item-text text-muted">Brak drużyn</span>
      }
    </div>
  </div>

  @if (requiresClubConfirmation() && !selectedPartyId()) {
  <div class="text-danger mt-2">
    Aby zarezerwować salę klubową, musisz wybrać drużynę.
  </div>

  } @if (selectedPartyId()) {
  <div class="flex-row-align-center mt-2">
    <span class="me-2">
      Aktualnie wybrana drużyna: {{ getSelectedPartyName() }}
    </span>
    <button
      type="button"
      class="btn btn-danger btn-close-x"
      (click)="removeSelectedParty()"
    >
      x
    </button>
  </div>
  }

  <app-universal-calendar
    [dailyDataMap]="calendar.reservationsMap()"
    [mapDailyToHourlyAvailability]="mapReservationToHours()"
    [selectedDate]="selectedDate()"
    [selectionDisabled]="isSelectionDisabled()"
    [room]="selectedRoom()"
    [isMemberClubBlocked]="isMemberClubBlocked"
    (dateSelected)="selectDate($event)"
    (monthChanged)="onMonthChanged($event)"
  ></app-universal-calendar>

  @if (requiresClubConfirmation()) {
  <div class="form-check mt-3">
    <input
      class="form-check-input"
      type="checkbox"
      id="clubConfirm"
      [checked]="confirmedTeam()"
      (change)="onClubCheckboxChange($event)"
    />
    <label class="form-check-label" for="clubConfirm">
      Oświadczam, że wszyscy gracze posiadają członkostwo Klubu Gier Fabularnych
      Ragnaroku.
    </label>
  </div>
  }
</div>
