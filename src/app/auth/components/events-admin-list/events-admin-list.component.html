<div class="events-admin-list">
  <div class="container">
    <div class="d-flex align-items-center justify-content-between gap-2 mb-3">
      <h2 class="section-title m-0">Wydarzenia</h2>

      <!-- przełącznik trybu widoku -->
      <div class="btn-group" role="group" aria-label="Tryb prezentacji">
        <button type="button"
                class="btn btn-outline"
                [class.active]="viewMode() === 'tabs'"
                (click)="setViewMode('tabs')">
          Zakładki
        </button>
        <button type="button"
                class="btn btn-outline"
                [class.active]="viewMode() === 'accordion'"
                (click)="setViewMode('accordion')">
          Lista rozwijana
        </button>
      </div>
    </div>

    @if (eventsSig().length) {

      @switch (viewMode()) {

        @case ('tabs') {
          <!-- pasek chipów z eventami -->
          <div class="events-tabs" role="tablist" aria-label="Lista eventów">
            @for (e of eventsSig(); track e.slug) {
              <button
                type="button"
                class="btn btn-outline btn-sm"
                role="tab"
                [attr.aria-selected]="selected()?.slug === e.slug"
                [class.active]="selected()?.slug === e.slug"
                (click)="pickEvent(e.slug)"
                [title]="e.name">
                {{ e.name }}
              </button>
            }
          </div>

          @let ev = selected();
          @if (ev) {
            <section class="event-details card card-dark card-body event-card">
              <header class="header">
                <div class="title">
                  <h3 class="h5 m-0">{{ ev.name }}</h3>
                  <ul class="tags list-unstyled m-0">
                    @if (ev.isForBeginners) { <li class="tag">Dla początkujących</li> }
                    @if (ev.requiresHosts)   { <li class="tag">Wymaga prowadzących</li> }
                  </ul>
                </div>
                <div class="actions">
                  <button type="button" class="btn btn-primary btn-sm" (click)="goEdit()">
                    Edytuj
                  </button>
                </div>
              </header>

              <dl class="meta">
                <div><dt>Godziny</dt><dd>{{ ev.startTime.slice(0,5) }}–{{ ev.endTime.slice(0,5) }}</dd></div>
                <div><dt>Salki</dt><dd>{{ (ev.rooms || []).join(', ') || '—' }}</dd></div>
                <div><dt>Typ</dt><dd>{{ AttractionKindLabel[ev.attractionType] }}</dd></div>
                <div><dt>Zapisy prowadzących</dt><dd>{{ HostSignupScopeLabel[ev.hostSignup] }}</dd></div>
              </dl>

              @if (ev.shortDescription) {
                <p class="desc mb-3">{{ ev.shortDescription }}</p>
              }

              @if (ev.singleDate) {
                <div class="occ single">
                  <h4 class="h6">Termin</h4>
                  <div class="dates">
                    <button type="button" class="btn btn-outline btn-sm" (click)="goSignup(ev.singleDate)">
                      {{ ev.singleDate }}
                    </button>
                  </div>
                </div>
              } @else {
                <div class="occ">
                  <h4 class="h6">Terminy</h4>

                  <div class="month-block">
                    <div class="month-title">Ten miesiąc</div>
                    @if (occurrencesThisMonth().length) {
                      <div class="dates">
                        @for (d of occurrencesThisMonth(); track d) {
                          <button type="button" class="btn btn-outline btn-sm" (click)="goSignup(d)">
                            {{ d }}
                          </button>
                        }
                      </div>
                    } @else { <div class="muted">Brak terminów.</div> }
                  </div>

                  <div class="month-block">
                    <div class="month-title">Przyszły miesiąc</div>
                    @if (occurrencesNextMonth().length) {
                      <div class="dates">
                        @for (d of occurrencesNextMonth(); track d) {
                          <button type="button" class="btn btn-outline btn-sm" (click)="goSignup(d)">
                            {{ d }}
                          </button>
                        }
                      </div>
                    } @else { <div class="muted">Brak terminów.</div> }
                  </div>
                </div>
              }
            </section>
          }
        }

        @case ('accordion') {
  <div ngbAccordion class="events-accordion" [closeOthers]="true">
    @for (e of eventsSig(); track e.slug) {
      <div ngbAccordionItem [id]="e.slug">
        <h2 ngbAccordionHeader>
          <button ngbAccordionButton class="w-100">
            <div class="panel-title d-flex align-items-center justify-content-between gap-2 w-100">
              <div class="d-flex align-items-center gap-2 flex-wrap">
                <span class="fw-semibold">{{ e.name }}</span>

                @if (e.isForBeginners) {
                  <span class="badge text-bg-light">Dla początkujących</span>
                }
                @if (e.requiresHosts) {
                  <span class="badge text-bg-light">Wymaga prowadzących</span>
                }
              </div>

              <small class="text-muted d-none d-md-inline">
                {{ e.startTime.slice(0,5) }}–{{ e.endTime.slice(0,5) }}
                · {{ (e.rooms || []).join(', ') || '—' }}
                · {{ AttractionKindLabel[e.attractionType] }}
              </small>
            </div>
          </button>
        </h2>

        <div ngbAccordionCollapse>
          <div ngbAccordionBody>
            <div class="panel-content">
              @if (e.shortDescription) {
                <p class="mb-3">{{ e.shortDescription }}</p>
              }

              <dl class="meta meta--compact mb-3">
                <div><dt>Godziny</dt><dd>{{ e.startTime.slice(0,5) }}–{{ e.endTime.slice(0,5) }}</dd></div>
                <div><dt>Salki</dt><dd>{{ (e.rooms || []).join(', ') || '—' }}</dd></div>
                <div><dt>Typ</dt><dd>{{ AttractionKindLabel[e.attractionType] }}</dd></div>
                <div><dt>Zapisy prowadzących</dt><dd>{{ HostSignupScopeLabel[e.hostSignup] }}</dd></div>
              </dl>

              @if (e.singleDate) {
                <div class="occ single">
                  <h4 class="h6">Termin</h4>
                  <div class="dates">
                    <button type="button" class="btn btn-outline btn-sm" (click)="goSignupFor(e.slug, e.singleDate)">
                      {{ e.singleDate }}
                    </button>
                  </div>
                </div>
              } @else {
                <div class="occ">
                  <h4 class="h6">Terminy</h4>

                  <div class="month-block">
                    <div class="month-title">Ten miesiąc</div>
                    @if (listOccurrences(e, 'this').length) {
                      <div class="dates">
                        @for (d of listOccurrences(e, 'this'); track d) {
                          <button type="button" class="btn btn-outline btn-sm" (click)="goSignupFor(e.slug, d)">
                            {{ d }}
                          </button>
                        }
                      </div>
                    } @else { <div class="muted">Brak terminów.</div> }
                  </div>

                  <div class="month-block">
                    <div class="month-title">Przyszły miesiąc</div>
                    @if (listOccurrences(e, 'next').length) {
                      <div class="dates">
                        @for (d of listOccurrences(e, 'next'); track d) {
                          <button type="button" class="btn btn-outline btn-sm" (click)="goSignupFor(e.slug, d)">
                            {{ d }}
                          </button>
                        }
                      </div>
                    } @else { <div class="muted">Brak terminów.</div> }
                  </div>
                </div>
              }

              <div class="mt-3 text-end">
                <button type="button" class="btn btn-primary btn-sm" (click)="pickEvent(e.slug); goEdit()">
                  Edytuj
                </button>
              </div>
            </div>
          </div>
        </div>

      </div>
    }
  </div>
}
      }

    } @else {
      <p class="muted">Brak wydarzeń.</p>
    }
  </div>
</div>
