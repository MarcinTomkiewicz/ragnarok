<div class="events-admin-list full-height">
  <div class="container">
      <h2 class="section-title mb-3">Poprowadź wydarzenie</h2>

    @if (visibleEvents().length) {

      <!-- pasek chipów tylko z widocznymi eventami -->
      <div class="events-tabs" role="tablist" aria-label="Lista eventów">
        @for (e of visibleEvents(); track e.id) {
          <button
            type="button"
            class="btn btn-outline btn-sm"
            role="tab"
            [attr.aria-selected]="selected()?.slug === e.slug"
            [class.active]="selected()?.slug === e.slug"
            (click)="pickEvent(e.slug)"
            [title]="e.name">
            {{ e.name }}
          </button>
        }
      </div>

      <!-- panel szczegółów wybranego eventu (karty zostają bez zmian) -->
      @let ev = selected();
      @if (ev) {
        <section class="card card-dark card-body event-details event-card">
          <header class="header">
            <div class="title">
              <h3 class="golden">{{ ev.name }}</h3>
              <div class="tags">
                @if (ev.isForBeginners) {
                  <span class="tag-badge green me-1">Dla początkujących</span>
                }
                @if (ev.attractionType) {
                  <span class="tag-badge club me-1">{{ getAttractionLabel(ev.attractionType) }}</span>
                }
              </div>
            </div>
            <div class="actions">
              <button type="button" class="btn btn-primary" (click)="goEdit()">
                Edytuj
              </button>
            </div>
          </header>

          <div class="meta">
            <div><dt>Godziny</dt><dd>{{ ev.startTime.slice(0,5) }}–{{ ev.endTime.slice(0,5) }}</dd></div>
            <div><dt>Salki</dt><dd>{{ (ev.rooms || []).join(', ') || '—' }}</dd></div>
            <div><dt>Typ</dt><dd>{{ AttractionKindLabel[ev.attractionType] }}</dd></div>
          </div>

          @if (ev.shortDescription) {
            <p class="desc">{{ ev.shortDescription }}</p>
          }

          @if (ev.singleDate) {
            <div class="dates">
              <h4 class="h6">Termin</h4>
              <div>
                <button
                  type="button"
                  class="btn btn-sm"
                  [class.btn-outline]="!(ev && isFull(ev.id, ev.singleDate))"
                  [class.btn-danger]="ev && isFull(ev.id, ev.singleDate)"
                  [disabled]="!(ev && canClick(ev, ev.singleDate))"
                  [attr.aria-disabled]="!(ev && canClick(ev, ev.singleDate)) || null"
                  (click)="ev && canClick(ev, ev.singleDate) ? goSignup(ev.singleDate) : null"
                  [title]="!(ev && canClick(ev, ev.singleDate)) ? 'Komplet — brak miejsc' : null">
                  {{ ev.singleDate }}
                </button>
              </div>
            </div>
          } @else {
            <div class="occ">
              <h4 class="h6">Zgłoszenie prowadzących</h4>

              <div class="month-block">
                <div class="month-title">Bieżący miesiąc</div>
                @if (occurrencesThisMonth().length) {
                  <div class="dates">
                    @for (d of occurrencesThisMonth(); track $index) {
                      <button
                        type="button"
                        class="btn btn-sm"
                        [class.btn-outline]="!(ev && isFull(ev.id, d))"
                        [class.btn-danger]="ev && isFull(ev.id, d)"
                        [disabled]="!(ev && canClick(ev, d))"
                        [attr.aria-disabled]="!(ev && canClick(ev, d)) || null"
                        (click)="ev && canClick(ev, d) ? goSignup(d) : null"
                        [title]="!(ev && canClick(ev, d)) ? 'Komplet — brak miejsc' : null">
                        {{ d }}
                      </button>
                    }
                  </div>
                } @else {
                  <div class="muted">Brak terminów.</div>
                }
              </div>

              <div class="month-block">
                <div class="month-title">Przyszły miesiąc</div>
                @if (occurrencesNextMonth().length) {
                  <div class="dates">
                    @for (d of occurrencesNextMonth(); track $index) {
                      <button
                        type="button"
                        class="btn btn-sm"
                        [class.btn-outline]="!(ev && isFull(ev.id, d))"
                        [class.btn-danger]="ev && isFull(ev.id, d)"
                        [disabled]="!(ev && canClick(ev, d))"
                        [attr.aria-disabled]="!(ev && canClick(ev, d)) || null"
                        (click)="ev && canClick(ev, d) ? goSignup(d) : null"
                        [title]="!(ev && canClick(ev, d)) ? 'Komplet — brak miejsc' : null">
                        {{ d }}
                      </button>
                    }
                  </div>
                } @else {
                  <div class="muted">Brak terminów.</div>
                }
              </div>
            </div>
          }
        </section>
      }

    } @else {
      <p class="muted">Brak wydarzeń dostępnych dla Twoich uprawnień.</p>
    }
  </div>
</div>
