<section class="offers-section full-height">
  <div class="container">

    @if (isLoading()) {
      <div class="offers-overlay" aria-hidden="true">
        <app-loader [active]="true" />
      </div>
    } @else {

      <h2 class="section-title">Ragnarok – marka własna</h2>
      <p class="section-subtitle">
        Produkty sygnowane marką własną: koszulki, torby, kubki i więcej.
      </p>

      <div class="offers-wrapper">
        <!-- Sidebar: wspólny komponent kategorii/subkategorii -->
        <aside class="category-sidebar">
          <h3 class="sidebar-title">Kategorie</h3>
          <app-category-list
            [categories]="brandCategories()"
            [subcategories]="subcategories()"
            (subcategorySelected)="onSubcategoryClick($event)">
          </app-category-list>
        </aside>

        <!-- Dropdown na mobile: również wspólny komponent -->
        <div class="category-dropdown" ngbDropdown>
          <button class="btn btn-outline w-100" id="categories" ngbDropdownToggle>
            Kategorie
          </button>
          <div ngbDropdownMenu aria-labelledby="categories" class="w-100">
            <app-category-list
              [categories]="brandCategories()"
              [subcategories]="subcategories()"
              (subcategorySelected)="onSubcategoryClick($event)">
            </app-category-list>
          </div>
        </div>

        <div class="offers-list">
          <div class="sort-section">
            <span class="sort-label">Sortuj</span>
            <div class="flex-row-regular gap-2 flex-wrap">
              @for (field of sortFields(); track field) {
                <button class="btn btn-plain-light sort-button" (click)="sortBy(field)">
                  {{ offerLabels[field] }}
                  <i [ngClass]="getSortIcon(field)"></i>
                </button>
              }
            </div>

            <div class="search-box flex-grow-1">
              <input
                type="search"
                class="form-control"
                placeholder="Wyszukaj produkt marki..."
                [ngbTypeahead]="search"
                [resultFormatter]="resultFormatter"
                [inputFormatter]="inputFormatter"
                (selectItem)="onSelectOffer($event)" />
            </div>
          </div>

          @if (!offers().length) {
            <div class="no-offers">Brak produktów w tej sekcji.</div>
          } @else {
            <div class="offers-grid">
              @for (offer of offers(); track offer.slug) {

                @if (!isMobile()) {
                  <article class="offer-card">
                    <div class="card-img">
                      <img [src]="offer._imgUrl || ''" [alt]="offer.title" />
                    </div>
                    <div class="offer-content">
                      <h3>{{ offer.title }}</h3>
                      <p><strong>Cena:</strong> {{ offer.price }} PLN</p>
                      <p>
                        @if (offer.stock > 0) {
                          <strong>Sztuk na stanie:</strong> {{ offer.stock }}
                        } @else {
                          <strong class="text-danger">Produkt niedostępny</strong>
                        }
                      </p>
                      <div class="buttons">
                        <button
                          class="btn btn-primary"
                          [routerLink]="['/offers', 'store', offer.slug]">
                          Szczegóły
                        </button>
                        <button
                          class="btn btn-warning"
                          data-buynow
                          [attr.data-item-name]="offer.title"
                          [attr.data-price]="offer.price"
                          [disabled]="!offer.buyNowLink || !offer.stock"
                          (click)="buyNow(offer.buyNowLink)">
                          Kup Teraz
                        </button>
                      </div>
                    </div>
                  </article>
                } @else {
                  <article class="product-card-mobile card card-dark">
                    <img class="product-image" [src]="offer._imgUrl || ''" [alt]="offer.title" />
                    <div class="card-body">
                      <h3 class="card-title">{{ offer.title }}</h3>
                      <p class="card-text">Cena: {{ offer.price }} PLN</p>
                      <p class="card-text">
                        @if (offer.stock > 0) {
                          <strong>Sztuk na stanie:</strong> {{ offer.stock }}
                        } @else {
                          <strong class="text-danger">Produkt niedostępny</strong>
                        }
                      </p>
                      <div class="btn-group w-100 flex-column gap-2 mt-2">
                        <button
                          class="btn btn-primary"
                          [routerLink]="['/offers', 'store', offer.slug]">
                          Szczegóły
                        </button>
                        <button
                          class="btn btn-warning"
                          data-buynow
                          [attr.data-item-name]="offer.title"
                          [attr.data-price]="offer.price"
                          [disabled]="!offer.buyNowLink || !offer.stock"
                          (click)="buyNow(offer.buyNowLink)">
                          Kup Teraz
                        </button>
                      </div>
                    </div>
                  </article>
                }

              }
            </div>

            @if (totalOffers() > pageSize()) {
              <ngb-pagination
                class="pagination-wrapper"
                [collectionSize]="totalOffers()"
                [(page)]="currentPage"
                [pageSize]="pageSize()"
                (pageChange)="onPageChange($event)"
                [boundaryLinks]="true"
                [maxSize]="3"
                size="sm">
              </ngb-pagination>
            }
          }
        </div>
      </div>
    }
  </div>
</section>
